/*! flower-tower-defense 2022-07-12 */
!function(){window.Game={assets:[],waves:[{current:{}}]}}.call(this),function(){Game.assets.audio={Background:["assets/sounds/Background.ogg","assets/sounds/Background.mp3"],Boss:["assets/sounds/Boss.wav","assets/sounds/Boss.ogg","assets/sounds/Boss.mp3"],Menu:["assets/sounds/Menu.mp3","assets/sounds/Menu.ogg"],Won:["assets/sounds/Won.mp3","assets/sounds/Won.ogg","assets/sounds/Won.wav"],EnemyDead:["assets/sounds/EnemyDead.mp3","assets/sounds/EnemyDead.ogg"],LifeLost:["assets/sounds/LifeLost.mp3","assets/sounds/LifeLost.ogg","assets/sounds/LifeLost.wav"]}}.call(this),function(){Game.assets.images=["assets/images/ftd-logo.jpg","assets/images/transparent.png"]}.call(this),function(){Game.preLoadAssets={audio:{},images:[],sprites:{"assets/sprites/flower.png":{tile:32,tileh:32,map:{flower:[4,0],flower_tower1:[0,0],flower_tower2:[1,0],flower_tower3:[2,0],flower_tower4:[3,0],flower_tower5:[4,0],sniper_tower1:[5,0],sniper_tower2:[6,0],sniper_tower3:[10,0],sniper_tower4:[11,0],hero_tower:[12,0],spiral_tower:[14,0]}}}}}.call(this),function(){Game.assets.sprites={"assets/levels/background.jpg":{tile:800,tileh:480,map:{background1:[0,0]}},"assets/levels/background2.jpg":{tile:800,tileh:600,map:{background2:[0,0],background3:[1,0],background4:[0,1],background5:[1,1]}},"assets/levels/background3.jpg":{tile:800,tileh:600,map:{background6:[0,0]}},"assets/levels/background4.jpg":{tile:800,tileh:480,map:{background7:[0,0],background8:[0,1]}},"assets/levels/background5.jpg":{tile:800,tileh:565,map:{background9:[0,0]}},"assets/levels/preview-levels.png":{tile:133,tileh:80,map:{preview_level1:[0,0],preview_level2:[0,1],preview_level3:[0,2],preview_level4:[0,3],preview_level5:[0,4],preview_level6:[1,0],preview_level7:[1,1],preview_level8:[1,2],preview_level9:[1,3]}},"assets/sprites/enemies.png":{tile:32,tileh:32,map:{witch_right:[5,2],witch_up:[3,0],witch_down:[4,2],knight_right:[0,3],knight_left:[1,3],knight_down:[2,3],knight_up:[3,3],green_dragon:[2,0],silver_dragon:[1,1],orc:[2,2],spider:[1,2],squid:[4,3]}},"assets/sprites/leafs.png":{tile:16,tileh:16,map:{leaf_left:[0,0],leaf_up:[1,0],leaf_down:[0,1],leaf_right:[1,1]}}}}.call(this),function(){Crafty.c("Button",{init:function(){this.requires("2D, Text, Mouse, Tooltip"),this.overrideTextColorFunction(),this._highlightColor=Game.highlightColor,this.textFont(Game.generalButtonFont),this.enable(),Crafty.mobile&&this.bind("MouseUp",function(t){this._previousMouseUp?this.trigger("Click",t):this._previousMouseUp=!0})},overrideTextColorFunction:function(){this._previousColors=[],this._previousTextColor=this.textColor,this.textColor=function(t){return this._previousTextColor.call(this,t),this._previousColors.unshift(t),5<this._previousColors.length&&this._previousColors.pop(),this}},mouseOverHandler:function(){this._previousTextColor.call(this,this._highlightColor)},mouseOutHandler:function(){this.textColor(this._previousColors[0]),this._previousMouseUp=!1},enable:function(){return this.textColor(Game.textColor),this.bind("MouseOver",this.mouseOverHandler),this.bind("MouseOut",this.mouseOutHandler),this.attr({buttonEnabled:!0}),this},disable:function(){return this.unbind("MouseOver",this.mouseOverHandler),this.unbind("MouseOut",this.mouseOutHandler),this.textColor(Game.disabledColor),this.attr({buttonEnabled:!1}),this},highlightColor:function(t){return this._highlightColor=t,this},withImage:function(t){var e=Crafty.e("2D, Image, "+(this.has("Canvas")?"Canvas":"DOM"));return e.image(t).attr({x:this.x,y:this.y}),this.attach(e),this},withSprite:function(t){return this.addComponent(t),this}})}.call(this),function(){Crafty.c("DOMButton",{init:function(){var e;this.requires("Button, DOM"),this.css(Game.buttonCss),e=this.text,this.text=function(t){return null==t?this._text:(e.call(this,t),this._element.innerHTML=this._text,this)},this.enable=function(){return this.attr({buttonEnabled:!0}),this.removeComponent("disabledButton"),this},this.disable=function(){return this.attr({buttonEnabled:!1}),this.addComponent("disabledButton"),this}}})}.call(this),function(){Crafty.c("PauseButton",{init:function(){return this.requires("DOMButton, Grid, Keyboard"),this.pauseOverlay=Crafty.e("PauseOverlay"),this.text("Pause").textFont(Game.waveFont).at(13,Game.map_grid.height-1).attr({w:100,h:50}).tooltip("Pause or unpause the game (Hotkey: P)").bind("Click",this.pauseUnpause).bind("KeyDown",this.pauseUnpause)},pauseUnpause:function(){Crafty.isPaused();return Crafty.pause(),Crafty.isPaused()?this.pauseOverlay.open():this.pauseOverlay.close()}})}.call(this),function(){Crafty.c("RestartButton",{init:function(){this.requires("DOMButton"),this.text("Start again?"),this.tooltip("Clicking this button starts another game"),this.attr({x:0,y:Game.height()-100,w:Game.width(),h:50}),this.textFont(Game.restartFont),this.textColor(Game.restartColor),this.bind("Click",function(){console.log("Restaaaaaart"),Crafty.isPaused()&&Crafty.pause(),Crafty.scene("Difficulty")})}})}.call(this),function(){Crafty.c("SoundButton",{init:function(){this.requires("DOMButton"),Crafty.storage("muted")?(Crafty.audio.mute(),this.text("Sound: Off"),this.tooltip("Sound is off. Click to turn it on.")):(this.text("Sound: On"),this.tooltip("Sound is on. Click to turn it off.")),this.bind("Click",function(){Crafty.audio.muted?(Crafty.audio.unmute(),this.text("Sound: On"),this.tooltip("Sound is on. Click to turn it off."),Crafty.storage("muted",!1)):(Crafty.audio.mute(),this.text("Sound: Off"),this.tooltip("Sound is off. Click to turn it on."),Crafty.storage("muted",!0))})}})}.call(this),function(){Crafty.c("WaveButton",{init:function(){this.requires("DOMButton, Grid, Delay"),this.attr({w:150,tooltipWidth:350,clickEnabled:!0}),this.text("Start"),this.tooltip("Starts the next wave of enemies. Click here once you placed your towers."),this.textFont(Game.waveFont),this.blinkBeforeStart(),this.startNextWaveOnClick()},blinkBeforeStart:function(){var t=!1;this.delay(function(){this.wave.waveStarted||(t?this.textColor(Game.textColor):this.textColor(Game.highlightColor),t=!t)},1e3,-1)},startNextWaveOnClick:function(){this.bind("Click",function(){this.clickEnabled&&(this.clickEnabled=!1,this.text("Next Wave"),this.textColor(Game.disabledColor),this.tooltip("Button currently disabled."),this.wave.gameStarted&&(Game.money+=Game.moneyAfterWave),this.wave.startNextWave(),this.wave.gameStarted=!0,this.delay(function(){this.clickEnabled=!0,this.textColor(Game.textColor),this.tooltip("Start next wave early to get wave finished bonus gold.")},1e4,0))})}})}.call(this),function(){var e,i,a;Crafty.c("ActualFPS",(a=i=e=void 0,{init:function(){e=(new Date).getTime(),i=0,this.bind("ExitFrame",function(){var t=(new Date).getTime();1e3<=t-e?(a=i,i=0,e=t):i++})},FPS:function(){return a}}))}.call(this),function(){Crafty.c("Bullet",{init:function(){return this.requires("2D, Canvas, Grid, Collision, PathWalker"),this.attr({damage:1})}})}.call(this),function(){Crafty.c("Enemy",{init:function(){var e;this.requires("2D, Canvas, Grid, Collision, PathWalker, Delay, Tooltip"),this.attr({tooltipWidth:150,tooltipHeight:30}),Game.enemyCount++,this.checkHits("Bullet"),this.bind("HitOn",function(t){this.hitWithDamage(t[0].obj.damage),t[0].obj.destroy()}),(e=this).delay(function(){e.tooltip((e.tooltipTextBase?e.tooltipTextBase+" with ":"")+this.health+" HP")},100,-1),this.bind("TweenEnded",function(t){e===t&&(Game.lifes-=this.livesTaken||1,this.kill(!1),Crafty.audio.play("LifeLost",1))})},hitWithDamage:function(t){this.health<=0||(this.attr({health:this.health-t}),this.health<=0&&(Game.money+=this.reward,this.kill()))},kill:function(t){void 0===t&&(t=!0),this.dead||(this.dead=!0,Game.enemyCount--,this.destroy(),Crafty.trigger("EnemyKilled",this),t&&Crafty.audio.play("EnemyDead",1,.15))}})}.call(this),function(){Crafty.c("Grid",{init:function(){this.attr({w:Game.map_grid.tile.width,h:Game.map_grid.tile.height})},at:function(t,e){return void 0===t&&void 0===e?{x:this.x/Game.map_grid.tile.width,y:this.y/Game.map_grid.tile.height}:(this.attr({x:t*Game.map_grid.tile.width,y:e*Game.map_grid.tile.height}),this)}})}.call(this),function(){Crafty.c("HudElement",{init:function(){this.requires("2D, DOM, Grid, Text"),this.attr({x:0,y:0,w:Game.width()}),this.textFont(Game.hudFont),this.textColor(Game.textColor)},observe:function(e,t,i){return void 0===i&&(i=""),this.observable=t,this.bind("EnterFrame",function(){var t=void 0;t="function"==typeof this.observable?this.observable.call():Game[this.observable],this.oldValue!==t&&(this.trigger("ValueChanged",t),this.oldValue=t)}),this.bind("ValueChanged",function(t){this.text(e+": "+t+i)}),this},alertIfBelow:function(e){return this.bind("ValueChanged",function(t){t<e?this.textColor(Game.alertColor):this.textColor(Game.textColor)}),this},highlight:function(){return this.bind("ValueChanged",function(t){0<t?this.textColor(Game.highlightColor):this.textColor(Game.textColor)}),this}})}.call(this),function(){Crafty.c("LevelSelector",{init:function(){this.requires("DOMButton, TweenXY")},level:function(t){return this.text("Level "+t),this.addComponent("preview_level"+t),this.bind("Click",function(){Crafty.scene("InitializeLevel"+t)}),this}})}.call(this),function(){Crafty.c("Path",{init:function(){return this.requires("2D, Canvas, Grid, Image, Color"),this.image("assets/images/transparent.png").color("#969600",.42)}})}.call(this),function(){Crafty.c("PathWalker",{animateAlong:function(t,e){for(var i={actor:this,speed:e=e||1,steps:[]},a=0;a<t.length;)i.steps.push({x:t[a].x*Game.map_grid.tile.width,y:t[a].y*Game.map_grid.tile.height}),a++;return Crafty.e("TweeningHandler").targets.push(i),this},animateTo:function(t,e,i){return this.animateAlong([{x:t,y:e}],i)},destroyAfterAnimation:function(){var e=this;return Crafty.bind("TweenEnded",function(t){t===e&&e.destroy()}),this}})}.call(this),function(){Crafty.c("Sidebar",{init:function(){var t,e;this.requires("2D, DOM, Mouse, Color"),this.attr({x:0,y:Game.map_grid.tile.height,w:170,h:Game.height()-2*Game.map_grid.tile.height,z:100}),this.color("#777777",.42),this.bind("MouseOver",function(t){t.preventDefault()}),e=this,t=Crafty.e("DOMButton").attr({x:e.w-27,y:this.y,w:25,h:25,z:101,tooltipWidth:50,tooltipHeight:75}).textFont(Game.closeFont).css(Game.closeCss).text("x").tooltip("Closes the sidebar").bind("Click",function(){e.close()}),this.upgradeHeadline=Crafty.e("2D, DOM, Text").attr({x:0,y:70,w:e.w,z:101}).textColor(Game.textColor).textFont(Game.sidebarFont),this.upgradeButton=Crafty.e("DOMButton").attr({x:0,y:160,w:e.w,h:40,z:101}).bind("Click",function(){e.selectedTower.upgrade()}),this.sellHeadline=Crafty.e("2D, DOM, Text").attr({x:0,y:260,w:e.w,z:101}).textColor(Game.textColor).textFont(Game.sidebarFont),this.sellButton=Crafty.e("DOMButton").attr({x:0,y:330,w:e.w,h:40,z:101}).bind("Click",function(){Crafty.e("TowerPlace").at(e.selectedTower.at().x,e.selectedTower.at().y),e.selectedTower.sell(),e.close()}),this.attach(t),this.attach(this.upgradeHeadline),this.attach(this.upgradeButton),this.attach(this.sellHeadline),this.attach(this.sellButton),this.close(),this.bind("TowerUpgraded",function(){e.updateTexts()})},highlightTower:function(){Crafty("Sidebar").selectedTower.color("#ffffff",.3)},openFor:function(t){this.selectedTower&&(this.selectedTower.unbind("MouseOut",this.highlightTower),this.selectedTower.color("#ffffff",0)),this.selectedTower=t,this.selectedTower.bind("MouseOut",this.highlightTower),this.selectedTower.x<Game.width()/2?this.x=Game.width()-this.w-Game.map_grid.tile.width:this.x=Game.map_grid.tile.width,this.updateTexts()},updateTexts:function(){var t=this.selectedTower.has("SniperTower")?"Sniper Tower":"Flower Tower";this.selectedTower.isUpgradable()?(this.upgradeHeadline.text("Upgrade "+t+" to level "+(this.selectedTower.level+1)+":"),this.upgradeButton.text("-"+this.selectedTower.getUpgradeCost()+"$").tooltip("Upgrade "+t+" at position ("+this.selectedTower.at().x+"/"+this.selectedTower.at().y+") to level "+(this.selectedTower.level+1)+" for "+this.selectedTower.getUpgradeCost()+"$")):(this.upgradeHeadline.text(t+": Maximum level reached"),this.upgradeButton.text("-").tooltip("Maximum level reached, can't upgrade tower")),this.sellHeadline.text("Sell "+t+":"),this.sellButton.text("+"+this.selectedTower.getSellValue()+"$").tooltip("Sell "+t+" at position ("+this.selectedTower.at().x+"/"+this.selectedTower.at().y+") to get back "+this.selectedTower.getSellValue()+"$")},close:function(){this.x=-this.w-50,this.selectedTower&&(this.selectedTower.unbind("MouseOut",this.highlightTower),this.selectedTower.color("#ffffff",0)),this.selectedTower=null}})}.call(this),function(){Crafty.c("Tooltip",{init:function(){this.requires("Mouse"),this.tooltipText="Tooltip-Text here",this._tooltip=null,this.tooltipWidth=300,this.tooltipHeight=50,this.baseZ=500,this.bind("MouseOver",this.createTooltip),this.bind("MouseOut",this.destroyTooltip)},disableTooltip:function(){return this.unbind("MouseOver",this.createTooltip),this.unbind("MouseOut",this.destroyTooltip)},createTooltip:function(){var t=Math.min(Game.width()-this.tooltipWidth-10,Math.max(0,this.x+(this.w-this.tooltipWidth)/2)),e=Math.max(0,this.y-this.tooltipHeight-10);this.y<this.h+this.tooltipHeight&&(e=this.y+this.h),this._tooltip=Crafty.e("2D, DOM, Mouse").attr({x:t,y:e,w:this.tooltipWidth,h:this.tooltipHeight,z:this.baseZ}).css(Game.generalTooltipCss),t=Crafty.e("2D, DOM, Text").attr({x:t+2,y:e+2,w:this.tooltipWidth,h:this.tooltipHeight,z:this.baseZ+20}).text(this.tooltipText).textFont(Game.generalTooltipFont).textColor(Game.textColor).css(Game.centerCss),this._tooltip.attach(t),this.attach(this._tooltip)},destroyTooltip:function(){this._tooltip.destroy()},tooltip:function(t){return this.tooltipText=t,this._tooltip&&0<this._tooltip._children.length&&this._tooltip._children[0].text(t),this}})}.call(this),function(){Crafty.c("Tree",{init:function(){return this.requires("2D, Canvas, Grid, Color"),this.color("rgb(20, 125, 40)")}})}.call(this),function(){Crafty.c("TweeningHandler",{init:function(){this.attr({targets:[],stepsPerGrid:25}),this.bind("EnterFrame",this.tweenHandler)},moveActor:function(t,e,i){var a=t.actor.x,r=t.actor.y;t.actor.x<t.steps[0].x?a=Math.min(t.actor.x+e,t.steps[0].x):t.actor.x>t.steps[0].x&&(a=Math.max(t.actor.x-e,t.steps[0].x)),t.actor.y<t.steps[0].y?r=Math.min(t.actor.y+i,t.steps[0].y):t.actor.y>t.steps[0].y&&(r=Math.max(t.actor.y-i,t.steps[0].y)),t.actor.attr({x:a,y:r})},triggerDirectionChanged:function(t){0!==t.steps.length&&(t.steps[0].x<t.actor.x?Crafty.trigger("TweenDirectionChanged",t.actor,"left"):t.steps[0].x>t.actor.x?Crafty.trigger("TweenDirectionChanged",t.actor,"right"):t.steps[0].y<t.actor.y?Crafty.trigger("TweenDirectionChanged",t.actor,"up"):t.steps[0].y>t.actor.y&&Crafty.trigger("TweenDirectionChanged",t.actor,"down"))},tweenHandler:function(){var t,e,i,a;if(!Crafty.isPaused())for(a=0;a<this.targets.length;)e=(t=this.targets[a]).speed*Game.map_grid.tile.width/this.stepsPerGrid,i=t.speed*Game.map_grid.tile.height/this.stepsPerGrid,t.actor.x!==t.steps[0].x||t.actor.y!==t.steps[0].y?this.moveActor(t,e,i):(t.steps.shift(),this.triggerDirectionChanged(t)),0===t.steps.length&&(this.targets.splice(a,1),a--,Crafty.trigger("TweenEnded",t.actor)),a++}})}.call(this),function(){Crafty.c("TweenXY",{init:function(){this.requires("2D")},moveTo:function(t,e,i){var a=1e3/Crafty.timer.FPS(),a={actor:this,speed:Math.max(Math.abs(t-this.x),Math.abs(e-this.y))*a/i,steps:[{x:t,y:e}]};return Crafty.e("TweeningHandler").targets.push(a),this}})}.call(this),function(){Crafty.c("Wave",{init:function(){this.currentWave=Game.currentWave,this.gameStarted=!1,this.automaticallyStartNextWave()},cancelWave:function(){if(this.enemySpawnDelay)return this.enemySpawnDelay.destroy()},automaticallyStartNextWave:function(){this.lastWaveFinishedTriggered=!1,this.bind("EnterFrame",function(){this.isWaveFinished()&&!this.isLastWave()&&this.isNextWavePossible()&&(Game.money+=Game.moneyAfterWave,this.startNextWave(),console.log("Automatically started wave "+this.currentWave)),this.isWaveFinished()&&this.isLastWave()&&!this.lastWaveFinishedTriggered&&(Crafty.trigger("LastWaveFinished"),this.lastWaveFinishedTriggered=!0,console.log("Last wave finished"))})},isWaveFinished:function(){return 0===Game.enemyCount&&this.spawnFinished&&!this.waveStarted},isLastWave:function(){return this.currentWave===Game.waves.current.length},isNextWavePossible:function(){return 0<Game.lifes&&(Game.endless||!this.isLastWave())},startNextWave:function(){this.spawnFinished=!1,this.waveStarted=!0,this.gameStarted&&Crafty.trigger("WaveFinished",this.currentWave),this.spawnEnemies(),this.currentWave===Game.waves.current.length-1&&(Crafty.audio.stop(),Crafty.audio.play("Boss",-1)),this.currentWave++,Game.currentWave=this.currentWave,console.log("Current wave: "+Game.currentWave)},spawnEnemies:function(){var t=this.getEnemies(),e=0,i=this;return this.enemySpawnDelay=Crafty.e("Delay").delay(function(){t[e]||(console.error("An error occurred: enemies[spawnedEnemies] is empty, spawnedEnemies is at: "+e),console.dir(t)),i.spawnEnemy(t[e]),++e===t.length&&(i.spawnFinished=!0,i.waveStarted=!1,console.log("spawn finished"))},this.getSpawnInterval(),t.length-1)},spawnEnemy:function(t){var e;if((t=Crafty.e(t).at(Game.path.start.x,Game.path.start.y)).animateAlong(Game.path.getAsList(),t.speed),this.currentWave>Game.waves.current.length)return e=this.currentWave-Game.waves.current.length,t.attr({health:Math.floor((1+.05*e)*t.health+5*e)}),console.log("new health: "+t.health)},getSpawnInterval:function(){var t=3e3;return t=this.currentWave>Game.waves.current.length?Math.max(200,3e3-50*(this.currentWave-Game.waves.current.length)):t},getEnemies:function(){var t,e;if(this.currentWave<Game.waves.current.length)return Game.waves.current[this.currentWave];for(t=["GreenDragon","Orc"],e=0;e<this.currentWave-Game.waves.current.length;)t.push(e%10==4?"SilverDragon":e%6==2?"GreenDragon":e%4==0?"MightyWitch":e%4==2?"FastKnight":"FastSquid"),e++;return t.push("GreenDragon"),t}})}.call(this),function(){Crafty.c("WaveStartIndicator",{init:function(){var t,e;if(this.requires("Delay"),t=Crafty("FlowerTower"),(e=0)<t.length)return this.delay(function(){t.get(e).shoot(),e++},500,t.length-1)}})}.call(this),function(){Crafty.c("FastKnight",{init:function(){this.requires("Enemy, knight_right"),this.attr({health:65,reward:15,speed:2.7,tooltipWidth:200,tooltipTextBase:"Fast Knight"})}})}.call(this),function(){Crafty.c("FastSquid",{init:function(){this.requires("Enemy, squid"),this.attr({health:23,reward:5,speed:2.5,tooltipWidth:200,tooltipTextBase:"Fast Squid"})}})}.call(this),function(){Crafty.c("GreenDragon",{init:function(){this.requires("Enemy, green_dragon"),this.attr({health:200,reward:50,speed:1.5,livesTaken:3,noInstantKill:!0,tooltipHeight:60,tooltipTextBase:"Green Dragon"})}})}.call(this),function(){Crafty.c("Knight",{init:function(){this.requires("Enemy, knight_right"),this.attr({health:50,reward:10,speed:1.3,tooltipWidth:200,tooltipTextBase:"Knight"})}})}.call(this),function(){Crafty.c("MightyWitch",{init:function(){this.requires("Enemy, witch_down, Delay"),this.attr({health:100,reward:20,speed:1.8,tooltipWidth:200,tooltipHeight:60,tooltipTextBase:"Mighty Witch (disables towers)"}),this.delay(function(){var t=Crafty("Tower Enabled");0<t.length&&t.get(Math.floor(Math.random()*t.length)).disable()},5e3,-1)}})}.call(this),function(){Crafty.c("Orc",{init:function(){this.requires("Enemy, orc"),this.attr({health:200,reward:30,speed:.8,livesTaken:2,tooltipTextBase:"Orc"})}})}.call(this),function(){Crafty.c("SilverDragon",{init:function(){this.requires("Enemy, silver_dragon"),this.attr({health:800,reward:150,speed:1.8,livesTaken:7,noInstantKill:!0,tooltipHeight:60,tooltipTextBase:"Silver Dragon"})}})}.call(this),function(){Crafty.c("Spider",{init:function(){this.requires("Enemy, spider"),this.attr({health:60,reward:5,speed:1.7,tooltipTextBase:"Spider"})}})}.call(this),function(){Crafty.c("Squid",{init:function(){this.requires("Enemy, squid"),this.attr({health:30,reward:3,speed:1,tooltipTextBase:"Squid"})}})}.call(this),function(){Crafty.c("Witch",{init:function(){this.requires("Enemy, witch_right"),this.attr({health:5,reward:1,speed:1.8,tooltipTextBase:"Witch"})}})}.call(this),function(){Game.difficulties={Easy:{textColor:"green",tooltip:"100 lifes, normal prices, lots of money",x:0,y:0,money:60,lifes:100,moneyAfterWave:20,towers:{FlowerTower:10,SniperTower:20,SniperTowerUpgrade:20}},Normal:{textColor:"yellow",tooltip:"40 lifes, normal prices, normal amount of money",x:1,y:0,money:30,lifes:40,moneyAfterWave:10,towers:{FlowerTower:10,SniperTower:20,SniperTowerUpgrade:20}},Hard:{textColor:"red",tooltip:"15 lifes, normal prices, less money after waves",x:0,y:1,money:25,lifes:15,moneyAfterWave:5,towers:{FlowerTower:12,SniperTower:20,SniperTowerUpgrade:25}},Impossible:{textColor:"#880044",tooltip:"10 lifes, higher prices, no money after waves",x:1,y:1,money:20,lifes:10,moneyAfterWave:0,towers:{FlowerTower:15,SniperTower:25,SniperTowerUpgrade:50}}}}.call(this),function(){Game.map_grid={width:25,height:15,tile:{width:32,height:32},pathMinLength:70,pathMaxLength:80},Game.options={bulletImages:!0,music:!0,soundEffects:!0},Game.speedup=1,Game.setGeneralProperties=function(){var t,e;for(Game.endless=!1,Game.enemyCount=0,Game.currentWave=0,Game.selectedTower="SniperTower",Game.sniperTowerInitial=this.towers.SniperTower,Game.towerMap=new Array(Game.map_grid.width),t=0;t<Game.map_grid.width;){for(Game.towerMap[t]=new Array(Game.map_grid.height),e=0;e<Game.map_grid.height;)Game.towerMap[t][e]={name:"",level:0},e++;t++}},Game.setDifficultyProperties=function(t){var e=Game.difficulties[t];Game.difficulty=t,Game.money=e.money,Game.lifes=e.lifes,Game.moneyAfterWave=e.moneyAfterWave,Game.towers={FlowerTower:e.towers.FlowerTower,SniperTower:e.towers.SniperTower,SniperTowerUpgrade:e.towers.SniperTowerUpgrade}},Game.width=function(){return this.map_grid.width*this.map_grid.tile.width},Game.height=function(){return this.map_grid.height*this.map_grid.tile.height}}.call(this),function(){Game.start=function(){Crafty.init(Game.width(),Game.height()),Crafty.background(Game.startBackgroundColor),Game.actualFPS=Crafty.e("ActualFPS"),Crafty.scene("Loading")}}.call(this),function(){Game.startBackgroundColor="rgb(169, 153, 145)",Game.mainMenuBackgroundColor="rgb(169, 153, 145)",Game.difficultyBackgroundColor="rgb(169, 153, 145)",Game.mapSelectionBackgroundColor="rgb(119, 123, 125)",Game.gameoverBackgroundColor="rgb(169, 153, 145)",Game.gameOverColor="red",Game.wonColor="rgb(109, 203, 105)",Game.continueColor="brown",Game.restartColor="brown",Game.headlineColor="black",Game.closeColor="black",Game.textColor="white",Game.highlightColor="black",Game.disabledColor="grey",Game.alertColor="red",Game.overlayColor="grey",Game.overlayConfirmColor="rgb(179, 136, 114)",Game.centerCss={"text-align":"center"},Game.buttonCss={"text-align":"center",cursor:"pointer"},Game.generalTooltipCss={padding:"5px",border:"1px solid black","background-color":"grey"},Game.overlayCss={padding:"10px",border:"1px solid black","background-color":Game.overlayColor},Game.overlayConfirmCss={padding:"5px",border:"1px solid black","background-color":Game.overlayConfirmColor},Game.closeCss={"line-height":"16px",border:"1px solid black",cursor:"pointer"},Game.hiddenCss={display:"none"},Game.shownCss={display:"block"},Game.loadingFont={size:"48px",family:"Arial"},Game.hudFont={size:"20px",family:"Arial"},Game.towerSelectorFont={size:"16px",family:"Arial"},Game.explanationFont={size:"16px",family:"Arial"},Game.difficultyFont={size:"36px",family:"Comic Sans MS"},Game.mapSelectionFont={size:"30px",family:"Comic Sans MS"},Game.waveFont={size:"25px",family:"sans-serif",weight:"bold"},Game.closeFont={size:"22px",family:"sans-serif","line-height":"22px"},Game.sidebarFont={size:"25px",family:"sans-serif",weight:"bold"},Game.creditsFont={size:"28px",family:"sans-serif",weight:"bold"},Game.creditsTextFont={size:"20px",family:"sans-serif",variant:"italic"},Game.gameOverFont={size:"48px",family:"sans-serif"},Game.wonFont={size:"48px",family:"Comic Sans MS"},Game.continueFont={size:"36px",family:"Comic Sans MS"},Game.restartFont={size:"36px",family:"sans-serif"},Game.generalButtonFont={size:"36px",family:"sans-serif"},Game.generalTooltipFont={size:"20px",family:"sans-serif"},Game.overlayInfoFont={size:"20px",family:"sans-serif"},Game.pauseFont={size:"36px",family:"sans-serif"}}.call(this),function(){Crafty.c("ConfirmOverlay",{init:function(){return this.baseZ=600,this.overlayWidth=300,this.overlayHeight=90,this.centerOverlayHorizontally(),this.centerOverlayVertically()},centerOverlayHorizontally:function(){return this.x=(Game.width()-this.overlayWidth)/2},centerOverlayVertically:function(){return this.y=(Game.height()-this.overlayHeight)/2},showOverlay:function(){var t,e,i=this,a=Crafty.e("2D, DOM, Mouse").attr({x:0,y:0,w:Game.width(),h:Game.height(),z:0}).bind("Click",function(){i.overlay.destroy(),a.destroy()});return this.overlay=Crafty.e("2D, DOM").attr({x:this.x,y:this.y,w:this.overlayWidth,h:this.overlayHeight,z:this.baseZ}).css(Game.overlayConfirmCss),t=Crafty.e("2D, DOM, Text").attr({x:this.x+2,y:this.y+2,w:this.overlayWidth,h:50,z:this.baseZ+20}).text(this.infoTextContent).textFont(Game.overlayInfoFont).textColor(Game.headlineColor).css(Game.centerCss),this.overlay.attach(t),e=this.triggerName,t=Crafty.e("DOMButton").attr({x:this.x+2,y:this.y+50,w:this.overlayWidth,h:50,z:this.baseZ+20}).text("Confirm").disableTooltip().bind("Click",function(){Crafty.trigger(e),i.overlay.destroy(),a.destroy()}),this.overlay.attach(t)}})}.call(this),function(){Crafty.c("Help",{init:function(){return this.generateHelp()},generateHelp:function(){return Crafty.e("2D, DOM").attr({x:x,y:y,w:overlayWidth,h:overlayHeight,z:baseZ}).css(Game.overlayCss)}})}.call(this),function(){Crafty.c("Overlay",{init:function(){return this.baseZ=600},centerOverlayHorizontally:function(){return this.x=(Game.width()-this.overlayWidth)/2},centerOverlayVertically:function(){return this.y=(Game.height()-this.overlayHeight)/2},generateOverlay:function(){return this.overlay=Crafty.e("2D, DOM").attr({x:this.x,y:this.y,w:this.overlayWidth,h:this.overlayHeight,z:this.baseZ}).css(Game.overlayCss)}})}.call(this),function(){Crafty.c("OverwriteSavegame",{init:function(){return this.requires("ConfirmOverlay"),this.infoTextContent="Starting a new game will overwrite your already saved game. Continue?",this.triggerName="OverwriteSavegameConfirmed"}})}.call(this),function(){Crafty.c("PauseOverlay",{init:function(){return this.requires("Overlay"),this.overlayWidth=100,this.overlayHeight=40,this.centerOverlayHorizontally(),this.centerOverlayVertically(),this.overlay=Crafty.e("2D, DOM, Text").attr({x:this.x,y:this.y,w:this.overlayWidth,h:this.overlayHeight,z:this.baseZ}).text("Paused").textFont(Game.pauseFont).textColor(Game.textColor).css(Game.overlayCss),this.close()},open:function(){return this.overlay.css(Game.shownCss)},close:function(){return this.overlay.css(Game.hiddenCss)}})}.call(this),function(){Crafty.c("RestartLevel",{init:function(){return this.requires("ConfirmOverlay"),this.infoTextContent="Really restart this level? You will restart at wave 1 with no towers!",this.triggerName="RestartLevel",this.showOverlay()}})}.call(this),function(){var t=class{constructor(t){this.width=t.width,this.height=t.height,this.generateStartInColumn(0),this.generateFinishInColumn(t.width-1),this.pathMinLength=t.pathMinLength||0,this.pathMaxLength=t.pathMaxLength||Math.MAX_VALUE,this.top=1,this.left=1,this.bottom=this.height-2,this.right=this.width-2,this.path=this.generateArrayWithFalseValues(this.width,this.height),this.occupied=this.generateArrayWithFalseValues(this.width,this.height),this.pointPath=[],this.pathLength=0}generateArrayWithFalseValues(t,e){for(var i,a=new Array(t),r=0;r<t;){for(a[r]=new Array(e),i=0;i<e;)a[r][i]=!1,i++;r++}return a}pointsEqual(t,e){return t.x===e.x&&t.y===e.y}generateStartInColumn(t){this.start={x:t,y:1+Math.floor(Math.random()*(this.height-2))}}generateStartOnRow(t){this.start={x:1+Math.floor(Math.random()*(this.width-2)),y:t}}generateFinishInColumn(t){this.finish={x:t,y:1+Math.floor(Math.random()*(this.height-2))}}generateFinishOnRow(t){this.finish={x:this.start.x+Math.floor(Math.random()*(this.width-this.start.x-1)),y:t}}setStart(t,e){this.start={x:t,y:e}}setFinish(t,e){this.finish={x:t,y:e}}copy(t){this.start=t.start,this.finish=t.finish,this.width=t.width,this.height=t.height,this.pathMinLength=t.pathMinLength,this.pathMaxLength=t.pathMaxLength,this.path=t.path,this.occupied=t.occupied,this.pointPath=t.pointPath}addToPath(t){t.x<0||t.x>this.width-1?console.log("Illegal point!! at x="+t.x+";y="+t.y):(this.path[t.x][t.y]=!0,this.occupied[t.x][t.y]=!0,this.pointPath.push({x:t.x,y:t.y}))}addObstacle(t){t.x<0||t.x>this.width-1?console.log("Illegal point for addObstacle!! at x="+t.x+";y="+t.y):this.occupied[t.x][t.y]=!0}remove(t){var e;if(t.x<0||t.x>this.width-1)console.log("Illegal point!! at x="+t.x+";y="+t.y);else{for(this.path[t.x][t.y]=!1,this.occupied[t.x][t.y]=!1,this.pathLength--,e=this.pointPath.length-1;0<=e;){if(this.pointPath[e].x===t.x&&this.pointPath[e].y===t.y)return this.pointPath.splice(e,1),void console.log("Removed "+t.x+"/"+t.y+" from pointPath");e--}console.log("Could not find point at "+t.x+", "+t.y+" to remove.")}}isOnEdge(t,e){return(t!==this.start.x||e!==this.start.y)&&((t!==this.finish.x||e!==this.finish.y)&&(0===t||t===this.width-1||0===e||e===this.height-1))}isOccupied(t,e){return"number"==typeof t&&"number"==typeof e&&t<this.occupied.length&&0<=t&&this.occupied[t][e]}isOnPath(t,e){return"number"==typeof t&&"number"==typeof e&&t<this.path.length&&0<=t&&this.path[t][e]}getInDirection(t,e){if(!(t.x<0||t.x>this.width-1)){if(t={x:t.x,y:t.y},e===Direction.DOWN)t.y++;else if(e===Direction.RIGHT)t.x++;else if(e===Direction.UP)t.y--;else{if(e!==Direction.LEFT)throw"unknown direction";t.x--}return t}console.log("Illegal point!! at x="+t.x+";y="+t.y)}createPathElement(t,e){return t===Direction.DOWN&&(this.current.y<this.bottom||e)?(this.current.y++,this.addToPath(this.current),this.pathLength++,!0):t===Direction.RIGHT&&(this.current.x<this.right||e)?(this.current.x++,this.addToPath(this.current),this.pathLength++,!0):t===Direction.UP&&(this.current.y>this.top||e)?(this.current.y--,this.addToPath(this.current),this.pathLength++,!0):!(t!==Direction.LEFT||!(this.current.x>this.left||e))&&(this.current.x--,this.addToPath(this.current),this.pathLength++,!0)}createPathElementIgnoreBorders(t){this.createPathElement(t,!0)}continuePathTo(t,e,i){var a=void 0,r=void 0,s=(new Date).getTime();for(a=t<this.current.x?Direction.LEFT:Direction.RIGHT,r=e<this.current.y?Direction.UP:Direction.DOWN;t!==this.current.x||e!==this.current.y;){if(5e3<(new Date).getTime()-s){console.log("Timeout after 5 seconds!! total="+this.pathLength),console.log("current.x="+this.current.x+"; current.y="+this.current.y),console.log("start.x="+this.start.x+"; start.y="+this.start.y),console.log("finish.x="+this.finish.x+"; finish.y="+this.finish.y);break}t!==this.current.x&&this.createPathElement(a,i),e!==this.current.y&&this.createPathElement(r,i)}}getAsList(){if(this.pointPath)return this.pointPath}};window.Path=t}.call(this),function(){Path.prototype.generatePath=function(){this.current={x:this.start.x,y:this.start.y},this.horizontal=0===this.start.x,this.generateNextPart()},Path.prototype.generatePartInRandomDirection=function(t,e){var i=Math.floor(3*Math.random()),a=this.horizontal?"x":"y",r=this.horizontal?"y":"x",s=this.horizontal?"width":"height";switch(i){case 0:if(null!==t&&0!==t&&1!==t||null!==e&&0!==e&&1!==e||!(this.current[a]<this[s]-3||this.finish[r]<this.current[r])||!(this.pathLength<=this.pathMaxLength||this.finish[r]<this.current[r])||!this.createPathElement(this.horizontal?Direction.UP:Direction.LEFT))break;return this.generateNextPart(i,t),!1;case 1:if((this.current[a]<this[s]/3||this.pathLength>=this.pathMinLength||Math.random()<.05)&&this.createPathElement(this.horizontal?Direction.RIGHT:Direction.DOWN))return this.generateNextPart(i,t),!1;break;case 2:if((null===t||2===t||1===t)&&(null===e||2===e||1===e)&&(this.current[a]<this[s]-3||this.finish[r]>this.current[r])&&(this.pathLength<=this.pathMaxLength||this.finish[r]>this.current[r])&&this.createPathElement(this.horizontal?Direction.DOWN:Direction.RIGHT))return this.generateNextPart(i,t),!1}return!0},Path.prototype.generateNextPart=function(t,e){var i=!0,a=(new Date).getTime(),r=this.horizontal?"x":"y",s=this.horizontal?"y":"x";if(this.current.x===this.start.x&&this.current.y===this.start.y)return console.log("Started generating path "+(this.horizontal?"horizontally":"vertically")),this.addToPath(this.current),this.pathLength=1,this.createPathElement(this.horizontal?Direction.RIGHT:Direction.DOWN),void setTimeout(this.generateNextPart(Direction.RIGHT),50);if(this.current[r]===this.finish[r]-1&&this.current[s]===this.finish[s])return this.current[r]+=1,this.addToPath(this.current),void console.log("Finished creating random path \\o/ (length="+this.pathLength+")");for(;i;){if(5e3<(new Date).getTime()-a){console.log("Timeout after 5 seconds!! total="+this.pathLength),console.log("current.x="+this.current.x+"; current.y="+this.current.y),console.log("start.x="+this.start.x+"; start.y="+this.start.y),console.log("finish.x="+this.finish.x+"; finish.y="+this.finish.y);break}i=this.generatePartInRandomDirection(t,e)}}}.call(this),function(){Path.prototype.generateLabyrinth=function(){var t,e,i,a,r,s,o,n,h,l;for(this.current={x:this.start.x,y:this.start.y},this.addToPath(this.current),this.pathLength=1,this.left=3,this.top=3,this.right=this.width-4,this.bottom=this.height-4,l=new StateMachine,h=(new Date).getTime(),n=0,l.setStart("start"),0===this.current.x?l.put("start",void 0,"goright",1):0===this.current.y?l.put("start",void 0,"godown",0):this.current.y===this.height-1?l.put("start",void 0,"goup",2):this.current.x===this.width-1&&l.put("start",void 0,"goleft",3),l.put("goright",Direction.DOWN,"godown_or_right"),l.put("goright",Direction.RIGHT,"goright"),l.put("goright",Direction.UP,"goup_or_right"),l.put("godown",Direction.RIGHT,"godown_or_right"),l.put("godown",Direction.DOWN,"godown"),l.put("godown",Direction.LEFT,"godown_or_left"),l.put("goup",Direction.RIGHT,"goup_or_right"),l.put("goup",Direction.UP,"goup"),l.put("goup",Direction.LEFT,"goup_or_left"),l.put("goleft",Direction.DOWN,"godown_or_left"),l.put("goleft",Direction.LEFT,"goleft"),l.put("goleft",Direction.UP,"goup_or_left"),l.put("godown_or_left",Direction.DOWN,"godown"),l.put("godown_or_left",Direction.LEFT,"goleft"),l.put("godown_or_right",Direction.DOWN,"godown"),l.put("godown_or_right",Direction.RIGHT,"goright"),l.put("goup_or_left",Direction.UP,"goup"),l.put("goup_or_left",Direction.LEFT,"goleft"),l.put("goup_or_right",Direction.RIGHT,"goright"),l.put("goup_or_right",Direction.UP,"goup");this.pathLength<.95*this.pathMaxLength&&!this.pointsEqual(this.getInDirection(this.current,Direction.UP),this.finish)&&!this.pointsEqual(this.getInDirection(this.current,Direction.RIGHT),this.finish)&&!this.pointsEqual(this.getInDirection(this.current,Direction.DOWN),this.finish)&&!this.pointsEqual(this.getInDirection(this.current,Direction.LEFT),this.finish);){if(5e3<(new Date).getTime()-h){console.log("Timeout after 5 seconds!! total="+this.pathLength),console.log("current.x="+this.current.x+"; current.y="+this.current.y),console.log("start.x="+this.start.x+"; start.y="+this.start.y),console.log("finish.x="+this.finish.x+"; finish.y="+this.finish.y);break}t=Math.floor(4*Math.random()),a=this.getInDirection(this.current,t),o=this.getInDirection(a,t),r=this.getInDirection(a,(t+1)%4),s=this.getInDirection(a,(t+3)%4),15<n?(this.remove(this.current),this.addObstacle(this.current),l.resetBy(1),this.isOnPath(this.current.x-1,this.current.y)?this.current.x--:this.isOnPath(this.current.x+1,this.current.y)?this.current.x++:this.isOnPath(this.current.x,this.current.y-1)?this.current.y--:this.isOnPath(this.current.x,this.current.y+1)&&this.current.y++,n=0):(n++,this.isOccupied(a.x,a.y)||this.isOnPath(o.x,o.y)||this.isOnPath(r.x,r.y)||this.isOnPath(s.x,s.y)||this.pathLength>=.9*this.pathMinLength&&(this.left=1,this.top=1,this.right=this.width-2,this.bottom=this.height-2,t===Direction.RIGHT&&0===this.finish.x)||((a=void 0)!==(o=l.transition(t))&&void 0!==o.output?a=this.createPathElement(o.output):void 0!==o&&(a=this.createPathElement(t)),a&&(n=0)))}e=Math.max(this.left,Math.min(this.finish.x,this.right)),i=Math.max(this.top,Math.min(this.finish.y,this.bottom)),this.continuePathTo(e,i),this.continuePathTo(this.finish.x,this.finish.y,!0),this.pathLength>=this.pathMinLength?console.log("Finished creating random labyrinth path \\o/ (length="+this.pathLength+")"):(this.top=1,this.left=1,this.bottom=this.height-2,this.right=this.width-2,this.path=this.generateArrayWithFalseValues(this.width,this.height),this.occupied=this.generateArrayWithFalseValues(this.width,this.height),this.pointPath=[],this.generateLabyrinth())}}.call(this),function(){var t=class{constructor(t,e,i){this.path=t,this.start=e||{x:0,y:1},this.finish=i||{x:this.path.width-1,y:this.path.height-2}}generate(){return this.path.start=this.start,this.path.finish=this.finish,this.path.current={x:this.start.x,y:this.start.y},this.path.addToPath(this.path.current),this.path.createPathElementIgnoreBorders(Direction.RIGHT),this.direction=new Direction(Direction.DOWN),console.log("Generating inward spiral"),this.inwardSpiral(),console.log("Generating spiral intersection"),this.spiralIntersection(),console.log("Generating outward spiral"),this.outwardSpiral(),this.path.createPathElementIgnoreBorders(Direction.RIGHT),console.log("Finished creating spiral, path length is: "+this.path.pathLength),this.path}inwardSpiral(){var t=(new Date).getTime();for(this.path.top=-1,this.path.right=this.path.width-2+2;this.path.top<this.path.bottom-1&&this.path.left<this.path.right-1;){if(5e3<(new Date).getTime()-t){console.log("Timeout after 5 seconds!! total="+this.path.pathLength),console.log("current.x="+this.path.current.x+"; current.y="+this.path.current.y),console.log("start.x="+this.start.x+"; start.y="+this.start.y),console.log("finish.x="+this.finish.x+"; finish.y="+this.finish.y);break}if(!this.path.createPathElement(this.direction.value))switch(this.direction.turnLeft(),this.direction.value){case Direction.DOWN:this.path.bottom-=4;break;case Direction.RIGHT:this.path.right-=4;break;case Direction.UP:this.path.top+=4;break;case Direction.LEFT:this.path.left+=4}console.log()}}spiralIntersection(){switch(this.direction.value){case Direction.DOWN:this.path.top+=2,this.path.bottom+=2,this.path.left-=2,this.path.right-=2;break;case Direction.RIGHT:this.path.top+=2,this.path.bottom+=2,this.path.left+=2,this.path.right+=2;break;case Direction.UP:this.path.top-=2,this.path.bottom-=2,this.path.left+=2,this.path.right+=2;break;case Direction.LEFT:this.path.top-=2,this.path.bottom-=2,this.path.left-=2,this.path.right-=2}this.direction.turnRight(),this.path.createPathElementIgnoreBorders(this.direction.value),this.path.createPathElementIgnoreBorders(this.direction.value)}outwardSpiral(){for(var t=(new Date).getTime();this.path.current.x<this.path.finish.x-1||this.path.current.y<this.path.finish.y;){if(5e3<(new Date).getTime()-t){console.log("Timeout after 5 seconds!! total="+this.path.pathLength),console.log("current.x="+this.path.current.x+"; current.y="+this.path.current.y),console.log("start.x="+this.start.x+"; start.y="+this.start.y),console.log("finish.x="+this.finish.x+"; finish.y="+this.finish.y);break}if(!this.path.createPathElement(this.direction.value))switch(this.direction.turnRight(),this.direction.value){case Direction.DOWN:this.path.bottom+=4;break;case Direction.RIGHT:this.path.right+=4;break;case Direction.UP:this.path.top-=4;break;case Direction.LEFT:this.path.left-=4}}}};window.PathGeneratorSpiral=t}.call(this),function(){Crafty.scene("Credits",function(t){Crafty.e("2D, DOM, Text").text("Programming:").textFont(Game.creditsFont).textColor(Game.highlightColor).css(Game.centerCss).attr({x:0,y:30,w:Game.width(),h:50}),Crafty.e("2D, DOM, Text").text('Game-Framework is Crafty (<a target="_blank" href="https://craftyjs.com">https://craftyjs.com</a>)<br />Programming is done by me (<a target="_blank" href="https://www.github.com/olilo/flower-tower-defense/">http://www.github.com/olilo/flower-tower-defense</a>)').textFont(Game.creditsTextFont).textColor(Game.textColor).css(Game.centerCss).attr({x:0,y:70,w:Game.width(),h:100}),Crafty.e("2D, DOM, Text").text("Graphics:").textFont(Game.creditsFont).textColor(Game.highlightColor).css(Game.centerCss).attr({x:0,y:140,w:Game.width(),h:50}),Crafty.e("2D, DOM, Text").text('roguelikebosses (orc, dragons, spider) by @JoeCreates (<a target="_blank" href="https://opengameart.org/content/roguelike-bosses">Joe Williamson</a>) <br />Witch graphic by Heather Harvey - cind_rella@hotmail.com<br />Generally: art from <a target="_blank" href="https://opengameart.org">https://opengameart.org</a><br />Knight and flowers by me ^^ (license-free)').textFont(Game.creditsTextFont).textColor(Game.textColor).css(Game.centerCss).attr({x:0,y:180,w:Game.width(),h:120}),Crafty.e("2D, DOM, Text").text("Music:").textFont(Game.creditsFont).textColor(Game.highlightColor).css(Game.centerCss).attr({x:0,y:300,w:Game.width(),h:50}),Crafty.e("2D, DOM, Text").text('Title-Song and Won-Song generated by Music Maker Jam (<a target="_blank" href="https://apps.microsoft.com/store/detail/music-maker-jam/9WZDNCRFJ9Z5">Music Maker Jam</a>)<br />Main Game-Music is "All her witches" by <a target="_blank" href="https://opengameart.org/users/tkz-productions">WakianTech</a>').textFont(Game.creditsTextFont).textColor(Game.textColor).css(Game.centerCss).attr({x:0,y:340,w:Game.width(),h:100}),t.text?Crafty.e("DOMButton").text(t.text).attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("Continue to next screen").bind("Click",function(){Crafty.scene(t.scene)}):Crafty.e("DOMButton").text("Back").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("Go back to where you came from").bind("Click",function(){Crafty.enterScene(t,{dontRestartMenuMusic:!0})}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50,blablubb:10})})}.call(this),function(){Crafty.scene("Difficulty",function(){for(var t in Crafty.background(Game.difficultyBackgroundColor),Crafty.e("2D, DOM, Image").image("assets/images/ftd-logo.jpg").attr({x:80,y:+Game.height()/12-24,w:Game.width(),h:200}),Crafty.e("2D, DOM, Text").text("Choose your difficulty:").attr({x:0,y:6*Game.height()/12-24,w:Game.width(),h:50}).textFont(Game.difficultyFont).textColor(Game.textColor).css(Game.centerCss),Game.difficulties)Game.difficulties.hasOwnProperty(t)&&Crafty.e("DOMButton").text(t).tooltip(Game.difficulties[t].tooltip).attr({x:Game.difficulties[t].x*Game.width()/2,y:(2*Game.difficulties[t].y+7)/12*Game.height(),w:Game.width()/2,h:50}).textFont(Game.difficultyFont).textColor(Game.difficulties[t].textColor).bind("Click",function(){console.log("Chosen difficulty: "+this.text()),Game.setDifficultyProperties(this.text()),Crafty.scene("MapSelection")});return Crafty.e("DOMButton").text("Instructions").attr({x:70,y:Game.height()-50,w:200,h:50}).tooltip("Click here for some instructions").bind("Click",function(){Crafty.scene("Help","Difficulty")}),Crafty.e("DOMButton").text("Credits").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("View the credits for this game ^^").bind("Click",function(){Crafty.scene("Credits","Difficulty")}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50})})}.call(this),function(){Crafty.scene("Game",function(){var t,e,i=Crafty.e("Wave");for(Crafty.e("2D, Canvas, "+Game.backgroundAsset),Crafty.audio.stop(),Crafty.audio.play("Background",-1,.35),Crafty.e("HudElement").observe("Money","money","$").at(1),Crafty.e("HudElement").observe("Lifes","lifes").at(6).alertIfBelow(3),Crafty.e("HudElement").observe("Enemies","enemyCount").at(10),Crafty.e("HudElement").observe("Wave","currentWave").at(14),Crafty.e("HudElement").observe("FPS",Game.actualFPS.FPS).at(18),Crafty.e("DOMButton, Grid").text("Restart level").tooltip("Restart this level with difficulty "+Game.difficulty+" at wave 1").textColor(Game.highlightColor).textFont(Game.hudFont).unbind("Click").bind("Click",function(){Crafty.e("RestartLevel"),Crafty.bind("RestartLevel",function(){return console.log("Restarting level at "+Game.level),i.cancelWave(),Crafty.isPaused()&&Crafty.pause(),Crafty.storage.remove("ftd_save1"),Game.setDifficultyProperties(Game.difficulty),Crafty.scene("InitializeLevel"+Game.level)})}).at(20,0).attr({w:180}),Crafty.e("TowerSelector").forTower("FlowerTower").attr({tooltipWidth:500,tooltipHeight:130}).tooltip("Click here to select the Flower Tower.<br> If you click anywhere on the map you build this tower.<br>It shoots in all 4 directions with limited range.<br> Gains higher range on upgrade.<br> Hotkey: C").withSprite("flower_tower5").withHotkey("C").at(1,Game.map_grid.height-1),Crafty.e("TowerSelector").forTower("SniperTower").attr({tooltipWidth:500,tooltipHeight:130}).tooltip("Click here to select the Sniper Tower.<br> If you click anywhere on the map you build this tower.<br> It shoots anywhere on the map, but cost increases.<br> Gains instant kill on highest level.<br> Hotkey: V").withSprite("sniper_tower4").withHotkey("V").at(3,Game.map_grid.height-1),Crafty.bind("EnterFrame",function(){Game.lifes<=0&&(Crafty.unbind("EnterFrame"),Crafty.scene("GameOver"))}),Crafty.bind("WaveFinished",function(t){Crafty.storage("ftd_save1",Game),console.log("Automatically saved game"),Crafty.e("WaveStartIndicator")}),Crafty.bind("LastWaveFinished",function(){return Crafty.storage.remove("ftd_save1"),Crafty.unbind("EnterFrame"),Crafty.scene("Won")}),Crafty.bind("TowerCreated",function(t){for(var e=["FlowerTower","SniperTower"],i=0;i<e.length;){if(t.has(e[i]))return Game.towerMap[t.at().x][t.at().y].name=e[i],void(Game.towerMap[t.at().x][t.at().y].level=1);i++}}),Crafty.bind("TowerUpgraded",function(t){Game.towerMap[t.at().x][t.at().y].level=t.level}),Game.towers.SniperTower=Game.sniperTowerInitial,t=0;t<Game.map_grid.width;){for(e=0;e<Game.map_grid.height;)Game.path.isOnEdge(t,e)?Crafty.e("Tree").at(t,e):Game.path.isOnPath(t,e)?Crafty.e("Path").at(t,e):0<Game.towerMap[t][e].level?Crafty.e(Game.towerMap[t][e].name).at(t,e).attr({level:Game.towerMap[t][e].level}).updateTooltip():Crafty.e("TowerPlace").at(t,e),e++;t++}return Crafty.e("WaveButton").attr({wave:i}).at(Game.map_grid.width-5,Game.map_grid.height-1),Crafty.e("Sidebar"),Crafty.e("DOMButton, Grid").text("Help").textFont(Game.waveFont).at(10,Game.map_grid.height-1).attr({w:100}).tooltip("If you are lost, look here").bind("Click",function(){var t=document.getElementById("helpOverlay");return t?t.parentNode.removeChild(t):((t=document.createElement("div")).setAttribute("id","helpOverlay"),t.style.position="absolute",t.style.width=Game.width()-40+"px",t.style.padding="10px",t.style.left="10px",t.style.top="30px",t.style.border="1px solid black",t.style.background="grey",t.style.zIndex="1000",t.innerHTML='<p>Click anywhere to build the selected tower type. You can find the selected tower type in the lower left of the screen (black is selected).</p><p>When you click on an already built tower you upgrade that tower. The costs and the current tower level are displayed on mouse over in the top right of the screen (Cost and Level).</p><p><em><strong>There are two tower types to choose from, with the first one automatically selected:</strong></em></p><p>The first tower type shoots leafs into all 4 directions, which damage the enemy on impact. They have a limited range so build these towers near the path. Their range increases on higher levels.</p><p>The second tower shoots all over the map at a single random target.The first tower you build of this type is relatively cheap, but each one after the first one gets more and more expensive. Upgrading, however, always costs the same.<br>This tower gains a 2% chance to instantly kill an enemy on its highest level.</p><p>You have to start the first wave by clicking "Start". After that the waves come automatically, but you can start the next wave earlier by clicking "Next Wave" again.</p><p>You win if you finish all 15 waves. You can challenge yourself and see how far you can get in endless mode after that.</p>',document.getElementById("cr-stage").appendChild(t))}),Crafty.e("PauseButton"),Crafty.e("DOMButton, Grid").text("Main Menu").textFont(Game.waveFont).attr({w:200,h:50}).at(5,Game.map_grid.height-1).tooltip("Clicking this button returns you to the main menu").bind("Click",function(){console.log("Main Menu"),i.cancelWave(),Crafty.scene("MainMenu")}),Crafty.e("SoundButton, Grid").textFont(Game.waveFont).attr({w:150,h:50}).at(16,Game.map_grid.height-1)})}.call(this),function(){Crafty.scene("GameOver",function(){return Crafty.background("rgb(169, 153, 145)"),Crafty.audio.stop(),Crafty.audio.play("Menu",-1,.5),Crafty.e("2D, DOM, Image").image("assets/images/ftd-logo.jpg").attr({x:80,y:+Game.height()/12-24,w:Game.width(),h:200}),Crafty.e("2D, DOM, Text").text("Game over").attr({x:0,y:3*Game.height()/5-24,w:Game.width()}).textFont(Game.gameOverFont).textColor(Game.gameOverColor).css(Game.centerCss),Crafty.e("RestartButton")})}.call(this),function(){Crafty.scene("Help",function(t){return Crafty.e("2D, DOM, Text").attr({x:10,y:10,w:Game.width()-20,h:Game.height()}).text('<p>Choose a difficulty and select a map. The game starts. You can click anywhere to build the selected tower type. You can find the selected tower type in the lower left of the screen (black is selected).</p><p>When you click on an already built tower you upgrade that tower. The costs and the current tower level are displayed on mouse over in the top right of the screen (Cost and Level).</p><p><em><strong>There are two tower types to choose from, with the first one automatically selected:</strong></em></p><p>The first tower type shoots leafs into all 4 directions, which damage the enemy on impact.They have a limited range so build these towers near the path. Their range increases on higher levels.</p><p>The second tower shoots all over the map at a single random target.The first tower you build of this type is relatively cheap,but each one after the first one gets more and more expensive.Upgrading, however, always costs the same.<br>This tower gains a 2% chance to instantly kill an enemy on its highest level.</p><p>You have to start the first wave by clicking "Start". After that the waves come automatically, but you can start the next wave earlier by clicking "Next Wave" again.</p><p>You win if you finish all 15 waves, but you can challenge yourself and see how far you can get in endless mode after that.</p>').textColor(Game.textColor).textFont(Game.explanationFont),Crafty.e("DOMButton").text("Back").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("Go back to where you came from").bind("Click",function(){Crafty.enterScene(t,{dontRestartMenuMusic:!0})}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50})})}.call(this),function(){Crafty.scene("InitializeLevel1",function(){var t=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss);Game.level="1",Game.backgroundAsset="background1",Game.waves.current=Game.waves.level1,Game.setGeneralProperties(),t.delay(function(){Game.path=new Path(Game.map_grid),new PathGeneratorSpiral(Game.path).generate(),Crafty.scene("Game")},400)}),Crafty.scene("InitializeLevel2",function(){var t=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss);Game.level="2",Game.backgroundAsset="background2",Game.waves.current=Game.waves.level2,Game.setGeneralProperties(),t.delay(function(){Game.path=new Path(Game.map_grid),Game.path.generatePath(),Crafty.scene("Game")},400)}),Crafty.scene("InitializeLevel3",function(){var t=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss);Game.level="3",Game.backgroundAsset="background6",Game.waves.current=Game.waves.level3,Game.setGeneralProperties(),t.delay(function(){Game.path=new Path(Game.map_grid),Game.path.generateStartOnRow(0),Game.path.finish={x:14,y:Game.map_grid.height-1},Game.path.generatePath(),Crafty.scene("Game")},400)}),Crafty.scene("InitializeLevel4",function(){var t=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss);Game.level="4",Game.backgroundAsset="background5",Game.waves.current=Game.waves.level4,Game.setGeneralProperties(),t.delay(function(){var t={width:Game.map_grid.width,height:Game.map_grid.height,tile:Game.map_grid.tile,pathMinLength:5,pathMaxLength:20};Game.path=new Path(t),Game.path.start={x:9,y:0},Game.path.finish={x:14,y:Game.map_grid.height-1},Game.path.generatePath(),Crafty.scene("Game")},400)}),Crafty.scene("InitializeLevel5",function(){var t=Crafty.e("2D, DOM, Text, Delay").text("Loading level, generating map...").attr({x:0,y:Game.height()/2-24,w:Game.width()}).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss);Game.level="5",Game.backgroundAsset="background9",Game.waves.current=Game.waves.level5,Game.setGeneralProperties(),t.delay(function(){Game.path=new Path(Game.map_grid),Game.path.pathMaxLength=110,Game.path.generateStartOnRow(0),Game.path.generateFinishInColumn(0),Game.path.generateLabyrinth(),Crafty.scene("Game")},400)})}.call(this),function(){Crafty.scene("Loading",function(){var t,e=Crafty.e("2D, Grid, DOM, Text, Delay").text("Loading...").attr({w:Game.width()}).at(0,5).textFont(Game.loadingFont).textColor(Game.textColor).css(Game.centerCss);Crafty.e("2D, Grid, DOM, Progress, Text").at(Game.map_grid.width/2-2,8).textFont(Game.loadingFont).textColor(Game.textColor).text("0%"),t=3,Crafty.load(Game.preLoadAssets,function(){e.delay(function(){22<=t&&(Crafty("flower Loading").destroy(),t=3),Crafty.e("2D, DOM, Grid, flower, Loading").at(t,10),t+=2},500,-1)}),Crafty.load(Game.assets,function(){Game.endless=!1,Game.userClicked=!1,Crafty.scene("MainMenu")},function(t){Crafty("Progress").text(Math.floor(t.percent)+"%")},function(t){console.error("Could not load asset "+t)})})}.call(this),function(){Crafty.defineScene("MainMenu",function(t){var e,i;Crafty.background(Game.mainMenuBackgroundColor),i=function(){return Crafty.audio.stop(),Crafty.audio.play("Menu",-1,.5)},!Game.userClicked||t&&t.dontRestartMenuMusic?Crafty.e("2D, DOM, Mouse").attr({x:0,y:0,w:Game.width(),h:Game.height()}).bind("Click",function(){Game.userClicked||(i(),Game.userClicked=!0)}):i(),Crafty.e("2D, DOM, Image").image("assets/images/ftd-logo.jpg").attr({x:80,y:+Game.height()/12-24,w:Game.width(),h:200}),e=Crafty.storage("ftd_save1"),t=Crafty.e("DOMButton").text("Load Saved game").attr({x:0,y:7*Game.height()/12-24,w:Game.width(),h:50,tooltipWidth:350}).bind("Click",function(){return Game.userClicked=!0,console.log("User clicked, set Game.userClicked to true")}),e?t.tooltip("Continue the game you played last time with difficulty "+e.difficulty+" on wave "+e.currentWave).bind("Click",function(){Game.difficulty=e.difficulty||"Normal",Game.money=e.money,Game.lifes=e.lifes,Game.moneyAfterWave=e.moneyAfterWave,Game.towers=e.towers,Game.level=e.level||"2",Game.backgroundAsset=e.backgroundAsset||"background1",Game.waves.current=e.waves.current||Game.waves.level2,Game.endless=e.currentWave>=Game.waves.current.length,Game.enemyCount=e.enemyCount,Game.currentWave=e.currentWave,Game.selectedTower=e.selectedTower,Game.sniperTowerInitial=e.sniperTowerInitial,Game.towerMap=e.towerMap,Game.path=new Path(Game.map_grid),Game.path.copy(e.path),Game.enemyCount=0,Crafty.scene("Game")}):t.tooltip("No savegame exists yet.").disable(),Crafty.e("DOMButton").text("Start new game").attr({x:0,y:9*Game.height()/12-24,w:Game.width(),h:50}).tooltip("Starts a new game. You can select the difficulty on the next screen.").bind("Click",function(){var t=function(){return Game.userClicked||(i(),Game.userClicked=!0),Crafty.scene("Difficulty")};e?(Crafty.e("OverwriteSavegame").attr({y:9*Game.height()/12-24-20}).showOverlay(),Crafty.bind("OverwriteSavegameConfirmed",function(){return Crafty.storage.remove("ftd_save1"),t()})):t()}),Crafty.e("DOMButton").text("Instructions").attr({x:70,y:Game.height()-50,w:200,h:50}).tooltip("Click here for some instructions").bind("Click",function(){Game.userClicked||(i(),Game.userClicked=!0),Crafty.scene("Help","MainMenu")}),Crafty.e("DOMButton").text("Credits").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("View the credits for this game ^^").bind("Click",function(){Game.userClicked||(i(),Game.userClicked=!0),Crafty.scene("Credits","MainMenu")}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50}).bind("Click",function(){Game.userClicked||(i(),Game.userClicked=!0)})})}.call(this),function(){Crafty.scene("MapSelection",function(){var t;return Crafty.background(Game.mapSelectionBackgroundColor),t=1,Crafty.e("2D, DOM, Image").image("assets/images/ftd-logo.jpg").attr({x:80,y:+Game.height()/12-24,w:Game.width(),h:200}),Crafty.e("2D, DOM, Text").text("Choose a map:").attr({x:0,y:3*Game.height()/6-24,w:Game.width(),h:50}).textFont(Game.mapSelectionFont).textColor(Game.textColor).css(Game.centerCss),Crafty.e("DOMButton, Delay, Previous").text("Prev").attr({x:+Game.width()/24,y:8*Game.height()/12-24,w:2*Game.width()/24,h:32}).tooltip("Show previous page of levels").disable().bind("Click",function(){this.buttonEnabled&&(t--,this.disable(),this.delay(function(){1<t&&this.enable(),Crafty("DOMButton Next").enable()},1e3),Crafty("LevelSelector").each(function(){this.moveTo(this.x+Game.width(),this.y,800)}))}),Crafty.e("DOMButton, Delay, Next").text("Next").attr({x:21*Game.width()/24,y:8*Game.height()/12-24,w:2*Game.width()/24,h:32}).tooltip("Show next page of levels").bind("Click",function(){this.buttonEnabled&&(t++,this.disable(),this.delay(function(){t<Crafty("Level").length/3&&this.enable(),console.log(Crafty("Level").length),Crafty("DOMButton Previous").enable()},1e3),Crafty("LevelSelector").each(function(){this.moveTo(this.x-Game.width(),this.y,800)}))}),Crafty.e("LevelSelector").level("1").tooltip("10 Waves of enemies who travel through a large spiral.").attr({x:4*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("LevelSelector").level("2").tooltip("15 Waves of enemies who travel from left to right.").attr({x:10*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("LevelSelector").level("3").tooltip("15 Waves of enemies who go from top to bottom.").attr({x:16*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("LevelSelector").level("4").tooltip("20 Waves in a fast-paced short path.").attr({x:28*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("LevelSelector").level("5").tooltip("15 Waves who travel through a maze.").attr({x:34*Game.width()/24,y:8*Game.height()/12-24,w:Game.width()/6,h:100}),Crafty.e("DOMButton").text("Instructions").attr({x:70,y:Game.height()-50,w:200,h:50}).tooltip("Click here for some instructions").bind("Click",function(){Crafty.scene("Help","MapSelection")}),Crafty.e("DOMButton").text("Credits").attr({x:280,y:Game.height()-50,w:200,h:50}).tooltip("View the credits for this game ^^").bind("Click",function(){Crafty.scene("Credits","MapSelection")}),Crafty.e("SoundButton").attr({x:470,y:Game.height()-50,w:200,h:50})})}.call(this),function(){Crafty.scene("Won",function(){return Crafty.background(Game.wonColor),Crafty.audio.stop(),Crafty.audio.play("Won",-1),Crafty.e("2D, DOM, Image").image("assets/images/ftd-logo.jpg").attr({x:80,y:+Game.height()/12-24,w:Game.width(),h:200}),Crafty.e("2D, DOM, Text").text("You won with "+Game.lifes+" lives left :)").attr({x:0,y:7*Game.height()/12-24,w:Game.width(),h:50}).textFont(Game.wonFont).textColor(Game.textColor).css(Game.centerCss),Crafty.e("DOMButton").text("Continue in endless mode?").tooltip("Click here to continue your last game from wave "+Game.waves.current.length).attr({x:0,y:9*Game.height()/12-24,w:Game.width(),h:50}).textFont(Game.continueFont).textColor(Game.continueColor).bind("Click",function(){Game.endless=!0,Crafty.scene("Game")}),Crafty.e("RestartButton").attr({x:0,y:11*Game.height()/12-24,w:Game.width(),h:50})})}.call(this),function(){Crafty.c("Disabled",{init:function(){this.requires("Color, Mouse, Delay"),this.color("#ff0000",.5),this.bind("MouseOut",function(){this.color("#ff0000",.5)}),this.delay(function(){this.removeComponent("Disabled"),this.addComponent("Enabled")},2e4,0)}})}.call(this),function(){Crafty.c("Enabled",{init:function(){this.requires("Color, Mouse"),this.color("#ffffff",0),this.bind("MouseOver",function(){this.color("#6666b6",.2)}),this.bind("MouseOut",function(){this.color("#ffffff",0)})},disable:function(){this.removeComponent("Enabled"),this.addComponent("Disabled")}})}.call(this),function(){Crafty.c("FlowerTower",{init:function(){var t,e;this.requires("Tower, flower_tower1"),this.range=4,this.maxLevel=10,this.shootingSpeed=.4,this.bind("TowerUpgraded",function(t){t===this&&this.handleLevelup()}),this.delay(function(){this.handleLevelup()},100,0),t=!(e=0),this.delay(function(){e++%4==0&&(t=this.isEnemyNear()),this.has("Enabled")&&t&&this.shoot()},1e3*this.shootingSpeed,-1)},handleLevelup:function(){var t;for(this.level===this.maxLevel?this.range=6:4<=this.level?this.range=5:this.range=4,t=1;t<Math.ceil(this.level/2);)this.removeComponent("flower_tower"+t),t++;this.addComponent("flower_tower"+Math.ceil(this.level/2)),this.updateTooltip()},updateTooltip:function(){this.tooltip("Flower Tower at level "+this.level+", <br>"+this.getDamage()+" damage per petal, <br>"+this.getDamage()/this.shootingSpeed+" dps in a square of "+this.range+" tiles <br>"+this.getUpgradeText())},shoot:function(){var t=this.at().x,e=this.at().y,i=void 0,a=void 0,r=void 0,s=void 0;s=Game.options.bulletImages?(i=Crafty.e("Bullet, leaf_up"),a=Crafty.e("Bullet, leaf_right"),r=Crafty.e("Bullet, leaf_down"),Crafty.e("Bullet, leaf_left")):(i=Crafty.e("Bullet").attr({w:16,h:16}),a=Crafty.e("Bullet").attr({w:16,h:16}),r=Crafty.e("Bullet").attr({w:16,h:16}),Crafty.e("Bullet").attr({w:16,h:16})),i.attr({damage:this.getDamage()}).at(t,e).animateTo(t,e-this.range,4).destroyAfterAnimation(),a.attr({damage:this.getDamage()}).at(t,e).animateTo(t+this.range,e,4).destroyAfterAnimation(),r.attr({damage:this.getDamage()}).at(t,e).animateTo(t,e+this.range,4).destroyAfterAnimation(),s.attr({damage:this.getDamage()}).at(t,e).animateTo(t-this.range,e,4).destroyAfterAnimation()},isEnemyNear:function(){var e=this.at().x-this.range-2,i=this.at().x+this.range+2,a=this.at().y-this.range-2,r=this.at().y+this.range+2,s=!1;return Crafty("Enemy").each(function(){var t=this.at();t.x>=e&&t.x<=i&&t.y>=a&&t.y<=r&&(s=!0)}),s},getDamage:function(){return this.level<6?this.level:Math.floor(Math.sqrt(this.level-5)*this.level)},getUpgradeCost:function(t){return void 0===t&&(t=this.level),Math.floor(Game.towers.FlowerTower*Math.pow(1.4,t))}})}.call(this),function(){Crafty.c("SniperTower",{init:function(){this.requires("Tower, SpriteAnimation, sniper_tower1"),this.attr({w:32,h:32}),this.maxLevel=6,this.bind("TowerUpgraded",function(t){t===this&&this.handleLevelup()}),this.bind("TowerSold",function(t){t===this&&(Game.towers.SniperTower=Math.floor(Game.towers.SniperTower/1.25))}),this.delay(function(){Game.towers.SniperTower=Math.floor(1.25*Game.towers.SniperTower),this.handleLevelup()},100,0),this.delay(function(){0<Game.enemyCount&&this.has("Enabled")&&this.shoot()},4e3,-1)},handleLevelup:function(){for(var t=1;t<Math.ceil((this.level+1)/2);)this.removeComponent("sniper_tower"+t),t++;this.addComponent("sniper_tower"+Math.ceil((this.level+1)/2)),this.updateTooltip()},updateTooltip:function(){this.tooltip("Sniper Tower at level "+this.level+", <br>"+this.getDamage()+" damage per petal, <br>"+this.getDamage()/4+" dps on the whole map <br> "+this.getUpgradeText())},shoot:function(){var t,e,i,a,r=Crafty("Enemy").get(0);r&&(this.level!==this.maxLevel||0!==Math.floor(50*Math.random())||r.noInstantKill?(this.delay(function(){r.hitWithDamage(this.getDamage())},500,0),t=this.at().x,i=this.at().y,e=Math.floor(r.at().x),a=Math.floor(r.at().y),Game.options.bulletImages&&Crafty.e("Bullet, leaf_right").attr({damage:0}).at(t,i).animateTo(e,a,35).destroyAfterAnimation()):(console.log("INSTANT KILL!!"),r.kill()))},getDamage:function(){return 5*this.level},getUpgradeCost:function(t){return void 0===t&&(t=this.level),Math.floor(1.5*Game.towers.SniperTowerUpgrade*Math.sqrt(t))}})}.call(this),function(){Crafty.c("Tower",{init:function(){this.requires("2D, Canvas, Grid, Mouse, Tooltip, Color, Delay, Enabled"),this.attr({level:1,tooltipWidth:250,tooltipHeight:110}),Crafty.mobile?this.bind("MouseUp",function(){this.previousMouseUp?this.upgrade():this.previousMouseUp=!0}):this.bind("Click",function(){Crafty("Sidebar").selectedTower===this?this.upgrade():Crafty("Sidebar").openFor(this)})},isUpgradable:function(){return this.level<this.maxLevel},upgrade:function(){var t=this.getUpgradeCost();this.isUpgradable()?(Game.money>=t&&(this.level++,Game.money-=t,Crafty.trigger("TowerUpgraded",this)),console.log("Upgraded tower ("+this.at().x+"/"+this.at().y+") for "+t)):console.log("Tower ("+this.at().x+"/"+this.at().y+") at max level, can't upgrade it")},getUpgradeText:function(){return this.isUpgradable()?"(Upgrade costs "+this.getUpgradeCost()+"$) <br>":"(maximum level reached)"},sell:function(){Game.money+=this.getSellValue(),Crafty.trigger("TowerSold",this),this.destroy(),console.log("Sold tower for "+this.getSellValue()+"$")},getSellValue:function(){for(var t,e=0,i=1;i<=this.level;)"MAX"!==(t=this.getUpgradeCost(i))&&(e+=t),i++;return Math.floor(.5*e)}})}.call(this),function(){Crafty.c("TowerPlace",{init:function(){this.requires("2D, Canvas, Grid, Delay, Mouse, Image, Color, Tooltip"),this.image("assets/images/transparent.png").color("#ffffff",0),this.bind("MouseOver",function(){this.color("#b66666",.2)}),this.bind("MouseOut",function(){this.color("#ffffff",0),this.previousMouseUp=!1}),Crafty.mobile&&this.bind("MouseUp",function(t){this.previousMouseUp?this.trigger("Click",t):this.previousMouseUp=!0}),this.tooltip("Build a new "+Game.selectedTower+" here for "+Game.towers[Game.selectedTower]+" gold"),this.bind("TowerCreated",function(){this.delay(function(){this.tooltip("Build a new "+Game.selectedTower+" here for "+Game.towers[Game.selectedTower]+" gold")},500,0)}),this.bind("TowerChanged",function(){this.tooltip("Build a new "+Game.selectedTower+" here for "+Game.towers[Game.selectedTower]+" gold")}),this.bind("Click",function(){var t;Game.money>=Game.towers[Game.selectedTower]&&(t=Crafty.e(Game.selectedTower).at(this.at().x,this.at().y),Game.money-=Game.towers[Game.selectedTower],Crafty.trigger("TowerCreated",t),Crafty("Sidebar").openFor(t),this.destroy())})}})}.call(this),function(){Crafty.c("TowerSelector",{init:function(){this.requires("DOMButton, Grid, Keyboard"),this.attr({x:0,y:Game.height()-Game.map_grid.tile.height,z:100}),this.textFont(Game.towerSelectorFont)},forTower:function(t){return this.targetTower=t,this.bind("EnterFrame",function(){this.oldValue!==Game.towers[t]&&this.text(Game.towers[t])}),this.bind("TowerCreated",function(){this.text(Game.towers[t])}),Game.selectedTower===this.targetTower?this.textColor(Game.highlightColor):this.textColor(Game.textColor),this.bind("TowerChanged",function(){Game.selectedTower===this.targetTower?this.textColor(Game.highlightColor):this.textColor(Game.textColor)}),this.bind("Click",function(){Game.selectedTower=t,Crafty.trigger("TowerChanged")}),this},withHotkey:function(t){return this.bind("KeyDown",function(){this.isDown(t)&&(Game.selectedTower=this.targetTower,Crafty.trigger("TowerChanged"))}),this}})}.call(this),function(){var t=function(){class t{constructor(t){this.value=t}turnLeft(){return this.value=(this.value+1)%4}turnRight(){return this.value=(this.value+3)%4}}return t.DOWN=0,t.RIGHT=1,t.UP=2,t.LEFT=3,t}.call(this);window.Direction=t}.call(this),function(){var t=class{constructor(){this.states={},this.current=void 0,this.history=[]}setStart(t){this.current=t,this.history.push(this.current)}produceFromState(t,e){return null==e?t:"object"==typeof e||"array"==typeof e?t+"_$$_"+JSON.stringify(e):t+"_$$_"+e}put(t,e,i,a,r){this.states[this.produceFromState(t,e)]={state:i,output:a,condition:r}}get(t){return void 0===t?this.current:this.history[(this.history.length+t)%this.history.length]}resetBy(t){for(var e=this.current,i=0;i<t;)this.current=this.history.pop(),i++;return e}transition(t){t=this.states[this.produceFromState(this.current,t)];if(void 0!==(t=t||this.states[this.produceFromState(this.current,void 0)])&&(void 0===t.condition||t.condition.call()))return this.current=t.state,this.history.push(this.current),t}simulate(t){t=this.states[this.produceFromState(this.current,t)];if(void 0!==(t=t||this.states[this.produceFromState(this.current,void 0)])&&(void 0===t.condition||t.condition.call()))return t}};window.StateMachine=t}.call(this),function(){Game.waves.level1=[["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch"],["Witch","Squid","Witch","Witch","Squid","Witch","Witch","Squid","Witch","Witch","Squid"],["Squid","Squid","Witch","FastSquid","Squid","Squid","Witch","FastSquid"],["Squid","FastSquid","Knight","Squid","FastSquid","Squid","Knight","Squid","Knight"],["FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight"],["FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","MightyWitch"],["FastSquid","MightyWitch","FastSquid","Spider","Witch","FastKnight","Knight","FastKnight","Squid","FastKnight","MightyWitch"],["Spider","Orc","Spider","MightyWitch","FastSquid","FastSquid","Spider","Orc","MightyWitch","FastSquid","Spider","Orc","FastSquid","Spider","MightyWitch"],["Orc","Orc","Orc","Orc","Orc","FastSquid","FastSquid","MightyWitch","FastKnight","Spider","Spider","Spider","Spider","Orc","GreenDragon","Spider","Orc","Spider","MightyWitch","FastSquid","FastSquid","Spider","Orc","MightyWitch","FastSquid","Spider","Orc","MightyWitch","FastSquid","Spider","GreenDragon"],["Spider","Orc","Spider","MightyWitch","FastSquid","FastSquid","Spider","Orc","MightyWitch","FastSquid","Spider","Orc","MightyWitch","FastSquid","Spider","MightyWitch","SilverDragon"]]}.call(this),function(){Game.waves.level2=[["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch"],["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Squid"],["Witch","Witch","Witch","Witch","Squid","Witch","Witch","Squid"],["Squid","Squid","Squid","FastSquid"],["Squid","FastSquid","Knight","Squid","FastSquid","Witch","Witch","Witch","Knight"],["FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight"],["FastSquid","FastSquid","FastSquid","FastSquid","FastSquid"],["FastSquid","Spider","FastSquid","Spider","Witch","Witch","Knight","Knight","MightyWitch"],["Spider","Witch","MightyWitch","FastSquid","Witch","MightyWitch","Orc"],["Orc","Orc","Orc","Orc","Orc","FastSquid","FastSquid","Witch","FastKnight"],["FastKnight","FastKnight","FastKnight","MightyWitch","MightyWitch","MightyWitch"],["Spider","FastSquid","Spider","FastSquid","Orc","Orc","Squid","GreenDragon"],["Spider","Spider","Orc","Orc","GreenDragon","FastSquid","FastSquid","Orc","GreenDragon"],["Witch","Squid","FastSquid","Knight","Spider","MightyWitch","Orc","FastKnight","GreenDragon"],["SilverDragon"]]}.call(this),function(){Game.waves.level3=[["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch"],["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Squid"],["Witch","Witch","Witch","Witch","Squid","Witch","Witch","Squid"],["Squid","Squid","Squid","FastSquid"],["Squid","FastSquid","Knight","Squid","FastSquid","Witch","Witch","Witch","Knight"],["FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight"],["FastSquid","FastSquid","FastSquid","FastSquid","FastSquid"],["FastSquid","Spider","FastSquid","Spider","Witch","Witch","Knight","Knight","MightyWitch"],["Spider","Witch","MightyWitch","FastSquid","Witch","MightyWitch","Orc"],["Orc","Orc","Orc","Orc","Orc","FastSquid","FastSquid","Witch","FastKnight"],["FastKnight","FastKnight","FastKnight","MightyWitch","MightyWitch","MightyWitch"],["Spider","FastSquid","Spider","FastSquid","Orc","Orc","Squid","GreenDragon"],["Spider","Spider","Orc","Orc","GreenDragon","FastSquid","FastSquid","Orc","GreenDragon"],["Witch","Squid","FastSquid","Knight","Spider","MightyWitch","Orc","FastKnight","GreenDragon"],["SilverDragon"]]}.call(this),function(){Game.waves.level4=[["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch"],["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Squid"],["Witch","Witch","Witch","Witch","Squid","Witch","Witch","Squid"],["Squid","Squid","Squid","FastSquid"],["Witch","Witch","Squid","Witch","Witch","FastSquid","Squid","Witch","Witch","Squid"],["Squid","FastSquid","Knight","Squid","FastSquid","Witch","Witch","Witch","Knight"],["Squid","FastSquid","Knight","Squid","FastSquid","Knight","Knight"],["FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight"],["FastSquid","FastSquid","FastSquid","FastSquid","FastSquid"],["FastSquid","Spider","FastSquid","Spider","Witch","Witch","Knight","Knight","MightyWitch"],["FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid","FastSquid"],["Spider","Witch","MightyWitch","FastSquid","Witch","MightyWitch","Orc"],["FastSquid","FastSquid","Spider","Orc","Knight","Knight","MightyWitch"],["Orc","Orc","Orc","Orc","Orc","FastSquid","FastSquid","Witch","FastKnight"],["FastKnight","FastKnight","FastKnight","MightyWitch","MightyWitch","MightyWitch"],["Spider","FastSquid","Spider","FastSquid","Orc","Orc","Squid","GreenDragon"],["Spider","Spider","Orc","Orc","GreenDragon","FastSquid","FastSquid","Orc","GreenDragon"],["FastKnight","FastKnight","FastKnight","FastKnight","FastKnight","FastKnight"],["Witch","Squid","FastSquid","Knight","Spider","MightyWitch","Orc","FastKnight","GreenDragon"],["SilverDragon"]]}.call(this),function(){Game.waves.level5=[["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch"],["Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Witch","Squid"],["Witch","Witch","Witch","Witch","Squid","Witch","Witch","Squid"],["Squid","Squid","Squid","FastSquid"],["Squid","FastSquid","Knight","Squid","FastSquid","Witch","Witch","Witch","Knight"],["FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight","FastSquid","Knight"],["FastSquid","FastSquid","FastSquid","FastSquid","FastSquid"],["FastSquid","Spider","FastSquid","Spider","Witch","Witch","Knight","Knight","MightyWitch"],["Spider","Witch","MightyWitch","FastSquid","Witch","MightyWitch","Orc"],["Orc","Orc","Orc","Orc","Orc","FastSquid","FastSquid","Witch","FastKnight"],["FastKnight","FastKnight","FastKnight","MightyWitch","MightyWitch","MightyWitch"],["Spider","FastSquid","Spider","FastSquid","Orc","Orc","Squid","GreenDragon"],["Spider","Spider","Orc","Orc","GreenDragon","FastSquid","FastSquid","Orc","GreenDragon"],["Witch","Squid","FastSquid","Knight","Spider","MightyWitch","Orc","FastKnight","GreenDragon"],["SilverDragon"]]}.call(this);